/**
 * Created by Administrator on 2015/11/12.
 */
var error = require("../common/error.js");
var tools = require("../common/tools.js");
var db = require("../common/mysql_helper.js");
var util = require("util");
var _ = require("lodash");
var request = require("request");
var async = require("async");
var searchR = require("../raw/searchRaw.js");

exports.add = function (req, res, next) {
    var cp = req.body;
    if (cp) {
        Campaign.findOneAndUpdate({name: cp.name},
            cp,
            {
                upsert: true,
                new: true,
                setDefaultsOnInsert: true
            }).lean().exec(function (err, campaign) {
                if (err) return next(err);
                res.json(campaign);
            })
    }
    else {
        next(new error.BadRequest());
    }
}

exports.get = function (req, res, next) {
    var sqlQuery = "SELECT city,abbr FROM rrc_front.cm_cities where online = 1 and city!='全国' order by abbr asc";
    var ip = _.trim(req.ip, '.');
    ip = "";
    var result = {};
    if (ip) {
        getCityByIP(ip, function (err, result1) {
            if (err) return next(error.ServerInternalError);
            if (result1.length > 0) {
                result.current_city = result1[0].address;
            }
            getAbbr(null, function (err, result2) {
                if (err) return next(error.ServerInternalError);
                //result.cities = result2;
                if (result2.length > 0) {
                    result.cities = _.pluck(result2, 'city');
                    result.cities_abbr = _.pluck(result2, 'abbr');
                    res.json(result);
                }
            });
        })
    } else {
        next(error.BadRequest);
    }
}

function getAbbr(input, cb) {
    var sqlQuery = "SELECT city,abbr FROM rrc_front.cm_cities where online = 1 and city!='全国' order by abbr asc";
    db.ExecuteQuery(sqlQuery, cb);
}

function getCityByIP(ip, cb) {
    ip = db.pool.escape(ip);
    var sqlQuery = util.format("select address from (SELECT * FROM (cm_ip) WHERE ip1 <= '%s' order by ip1 desc limit 10) as a where a.ip2 >= '%s'", ip, ip);
    db.ExecuteQuery(sqlQuery, cb);
}

exports.rpcGet = function (req, res, next) {
    var url = "http://localhost:9003/v3/city";
    //var url="http://localhost;8081/citylist";
    request.get(url, function (err, response, body) {
        if (err) next(error.ServerInternalError);
        var rt = JSON.parse(body);
        res.json(rt);
    })
}

exports.mrpcGet = function (obj, cb) {
    var ip = obj;
    var result = {};
    if (ip) {
        async.series([function a(cb) {
            getAbbr(null, cb);
        }, function b(cb) {
            getCityByIP(ip, cb);
        }], function (err, result) {
            if (err) return cb(err, null);
            result.cities = result[0];
            result.current_city = result[1];
            cb(err, result);
        })
    } else {
        cb(null, null);
    }
}

exports.deleteById = function (req, res, next) {
    var id = req.params.id;
    if (id) {
        //Campaign.findByIdAndRemove(campaign_id).exec(function (err, result) {
        //    if (err) return next(err);
        //    res.json(result);
        //})
    }
    else {
        next(new error.BadRequest());
    }
}

exports.getById = function (req, res, next) {
    var id = req.params.id;
    if (id) {
        //Campaign.findById(campaign_id).exec(function (err, result) {
        //    if (err) return next(err);
        //    res.json(result);
        //});
    }
    else {
        next(new error.BadRequest());
    }
}

exports.updateById = function (req, res, next) {
    var id = req.params.id;
    var body = req.body;
    if (id && body) {
        //Campaign.findByIdAndUpdate(campaign_id, campaign, {new: true}).exec(function (err, result) {
        //    if (err) return next(err);
        //    res.json(result);
        //});
    }
    else {
        next(new error.BadRequest());
    }
}

exports.searchFilterRaw = function (req, res, next) {
    if (searchR) {
        res.json(searchR);
    }
}

exports.getPoints = function (req, res, next) {
    var point = [
        {ip: '58.200.0.0', value: 130},
        {ip: '58.200.0.10', value: 94},
        {ip: '58.200.0.20', value: 98},
        {ip: '58.200.0.30', value: 122},
        {ip: '58.200.0.40', value: 94},
        {ip: '58.200.0.50', value: 114},
        {ip: '58.200.0.60', value: 123},
        {ip: '58.200.0.70', value: 120},
        {ip: '58.200.0.80', value: 119},
        {ip: '58.200.0.90', value: 101},
        {ip: '58.200.0.100', value: 121},
        {ip: '58.200.0.110', value: 101},
        {ip: '58.200.0.120', value: 119},
        {ip: '58.200.0.130', value: 91},
        {ip: '58.200.0.140', value: 117},
        {ip: '58.200.0.150', value: 118},
        {ip: '58.200.0.160', value: 116},
        {ip: '58.200.0.170', value: 103},
        {ip: '58.200.0.180', value: 90},
        {ip: '58.200.0.190', value: 97},
        {ip: '58.200.0.200', value: 90},
        {ip: '58.200.0.210', value: 91},
        {ip: '58.200.0.220', value: 110},
        {ip: '58.200.0.230', value: 104},
        {ip: '58.200.0.240', value: 99},
        {ip: '58.200.0.250', value: 97},
        {ip: '58.200.1.4', value: 130},
        {ip: '58.200.1.14', value: 133},
        {ip: '58.200.1.24', value: 101},
        {ip: '58.200.1.34', value: 100},
        {ip: '58.200.1.44', value: 116},
        {ip: '58.200.1.54', value: 122},
        {ip: '58.200.1.64', value: 103},
        {ip: '58.200.1.74', value: 105},
        {ip: '58.200.1.84', value: 108},
        {ip: '58.200.1.94', value: 130},
        {ip: '58.200.1.104', value: 98},
        {ip: '58.200.1.114', value: 97},
        {ip: '58.200.1.124', value: 124},
        {ip: '58.200.1.134', value: 133},
        {ip: '58.200.1.144', value: 111},
        {ip: '58.200.1.154', value: 99},
        {ip: '58.200.1.164', value: 134},
        {ip: '58.200.1.174', value: 103},
        {ip: '58.200.1.184', value: 127},
        {ip: '58.200.1.194', value: 97},
        {ip: '58.200.1.204', value: 118},
        {ip: '58.200.1.214', value: 105},
        {ip: '58.200.1.224', value: 97},
        {ip: '58.200.1.234', value: 95},
        {ip: '58.200.1.244', value: 127},
        {ip: '58.200.1.254', value: 106},
        {ip: '58.200.2.8', value: 115},
        {ip: '58.200.2.18', value: 101},
        {ip: '58.200.2.28', value: 132},
        {ip: '58.200.2.38', value: 113},
        {ip: '58.200.2.48', value: 111},
        {ip: '58.200.2.58', value: 120},
        {ip: '58.200.2.68', value: 95},
        {ip: '58.200.2.78', value: 108},
        {ip: '58.200.2.88', value: 133},
        {ip: '58.200.2.98', value: 100},
        {ip: '58.200.2.108', value: 124},
        {ip: '58.200.2.118', value: 96},
        {ip: '58.200.2.128', value: 113},
        {ip: '58.200.2.138', value: 99},
        {ip: '58.200.2.148', value: 96},
        {ip: '58.200.2.158', value: 91},
        {ip: '58.200.2.168', value: 120},
        {ip: '58.200.2.178', value: 127},
        {ip: '58.200.2.188', value: 104},
        {ip: '58.200.2.198', value: 119},
        {ip: '58.200.2.208', value: 115},
        {ip: '58.200.2.218', value: 120},
        {ip: '58.200.2.228', value: 127},
        {ip: '58.200.2.238', value: 124},
        {ip: '58.200.2.248', value: 96},
        {ip: '58.200.3.2', value: 127},
        {ip: '58.200.3.12', value: 127},
        {ip: '58.200.3.22', value: 94},
        {ip: '58.200.3.32', value: 91},
        {ip: '58.200.3.42', value: 110},
        {ip: '58.200.3.52', value: 91},
        {ip: '58.200.3.62', value: 94},
        {ip: '58.200.3.72', value: 133},
        {ip: '58.200.3.82', value: 117},
        {ip: '58.200.3.92', value: 125},
        {ip: '58.200.3.102', value: 101},
        {ip: '58.200.3.112', value: 133},
        {ip: '58.200.3.122', value: 118},
        {ip: '58.200.3.132', value: 93},
        {ip: '58.200.3.142', value: 126},
        {ip: '58.200.3.152', value: 131},
        {ip: '58.200.3.162', value: 95},
        {ip: '58.200.3.172', value: 106},
        {ip: '58.200.3.182', value: 90},
        {ip: '58.200.3.192', value: 121},
        {ip: '58.200.3.202', value: 125},
        {ip: '58.200.3.212', value: 101},
        {ip: '58.200.3.222', value: 133},
        {ip: '58.200.3.232', value: 120},
        {ip: '58.200.3.242', value: 120},
        {ip: '58.200.3.252', value: 94},
        {ip: '58.200.4.6', value: 97},
        {ip: '58.200.4.16', value: 91},
        {ip: '58.200.4.26', value: 107},
        {ip: '58.200.4.36', value: 126},
        {ip: '58.200.4.46', value: 117},
        {ip: '58.200.4.56', value: 129},
        {ip: '58.200.4.66', value: 128},
        {ip: '58.200.4.76', value: 122},
        {ip: '58.200.4.86', value: 98},
        {ip: '58.200.4.96', value: 126},
        {ip: '58.200.4.106', value: 113},
        {ip: '58.200.4.116', value: 97},
        {ip: '58.200.4.126', value: 92},
        {ip: '58.200.4.136', value: 108},
        {ip: '58.200.4.146', value: 98},
        {ip: '58.200.4.156', value: 130},
        {ip: '58.200.4.166', value: 92},
        {ip: '58.200.4.176', value: 111},
        {ip: '58.200.4.186', value: 93},
        {ip: '58.200.4.196', value: 121},
        {ip: '58.200.4.206', value: 132},
        {ip: '58.200.4.216', value: 113},
        {ip: '58.200.4.226', value: 106},
        {ip: '58.200.4.236', value: 120},
        {ip: '58.200.4.246', value: 127},
        {ip: '58.200.5.0', value: 135},
        {ip: '58.200.5.10', value: 92},
        {ip: '58.200.5.20', value: 94},
        {ip: '58.200.5.30', value: 113},
        {ip: '58.200.5.40', value: 102},
        {ip: '58.200.5.50', value: 124},
        {ip: '58.200.5.60', value: 100},
        {ip: '58.200.5.70', value: 96},
        {ip: '58.200.5.80', value: 95},
        {ip: '58.200.5.90', value: 112},
        {ip: '58.200.5.100', value: 100},
        {ip: '58.200.5.110', value: 103},
        {ip: '58.200.5.120', value: 98},
        {ip: '58.200.5.130', value: 92},
        {ip: '58.200.5.140', value: 114},
        {ip: '58.200.5.150', value: 98},
        {ip: '58.200.5.160', value: 107},
        {ip: '58.200.5.170', value: 91},
        {ip: '58.200.5.180', value: 95},
        {ip: '58.200.5.190', value: 118},
        {ip: '58.200.5.200', value: 120},
        {ip: '58.200.5.210', value: 104},
        {ip: '58.200.5.220', value: 92},
        {ip: '58.200.5.230', value: 105},
        {ip: '58.200.5.240', value: 111},
        {ip: '58.200.5.250', value: 106},
        {ip: '58.200.6.4', value: 98},
        {ip: '58.200.6.14', value: 112},
        {ip: '58.200.6.24', value: 119},
        {ip: '58.200.6.34', value: 98},
        {ip: '58.200.6.44', value: 119},
        {ip: '58.200.6.54', value: 127},
        {ip: '58.200.6.64', value: 108},
        {ip: '58.200.6.74', value: 125},
        {ip: '58.200.6.84', value: 108},
        {ip: '58.200.6.94', value: 112},
        {ip: '58.200.6.104', value: 124},
        {ip: '58.200.6.114', value: 111},
        {ip: '58.200.6.124', value: 96},
        {ip: '58.200.6.134', value: 100},
        {ip: '58.200.6.144', value: 95},
        {ip: '58.200.6.154', value: 133},
        {ip: '58.200.6.164', value: 101},
        {ip: '58.200.6.174', value: 92},
        {ip: '58.200.6.184', value: 119},
        {ip: '58.200.6.194', value: 111},
        {ip: '58.200.6.204', value: 101},
        {ip: '58.200.6.214', value: 109},
        {ip: '58.200.6.224', value: 91},
        {ip: '58.200.6.234', value: 102},
        {ip: '58.200.6.244', value: 99},
        {ip: '58.200.6.254', value: 117},
        {ip: '58.200.7.8', value: 109},
        {ip: '58.200.7.18', value: 108},
        {ip: '58.200.7.28', value: 131},
        {ip: '58.200.7.38', value: 105},
        {ip: '58.200.7.48', value: 128},
        {ip: '58.200.7.58', value: 120},
        {ip: '58.200.7.68', value: 95},
        {ip: '58.200.7.78', value: 102},
        {ip: '58.200.7.88', value: 106},
        {ip: '58.200.7.98', value: 128},
        {ip: '58.200.7.108', value: 92},
        {ip: '58.200.7.118', value: 118},
        {ip: '58.200.7.128', value: 121},
        {ip: '58.200.7.138', value: 112},
        {ip: '58.200.7.148', value: 107},
        {ip: '58.200.7.158', value: 101},
        {ip: '58.200.7.168', value: 96},
        {ip: '58.200.7.178', value: 106},
        {ip: '58.200.7.188', value: 126},
        {ip: '58.200.7.198', value: 103},
        {ip: '58.200.7.208', value: 108},
        {ip: '58.200.7.218', value: 93},
        {ip: '58.200.7.228', value: 130},
        {ip: '58.200.7.238', value: 94},
        {ip: '58.200.7.248', value: 122},
        {ip: '58.200.8.2', value: 113},
        {ip: '58.200.8.12', value: 129},
        {ip: '58.200.8.22', value: 121},
        {ip: '58.200.8.32', value: 107},
        {ip: '58.200.8.42', value: 96},
        {ip: '58.200.8.52', value: 108},
        {ip: '58.200.8.62', value: 99},
        {ip: '58.200.8.72', value: 91},
        {ip: '58.200.8.82', value: 123},
        {ip: '58.200.8.92', value: 106},
        {ip: '58.200.8.102', value: 106},
        {ip: '58.200.8.112', value: 101},
        {ip: '58.200.8.122', value: 123},
        {ip: '58.200.8.132', value: 121},
        {ip: '58.200.8.142', value: 118},
        {ip: '58.200.8.152', value: 113},
        {ip: '58.200.8.162', value: 98},
        {ip: '58.200.8.172', value: 135},
        {ip: '58.200.8.182', value: 132},
        {ip: '58.200.8.192', value: 121},
        {ip: '58.200.8.202', value: 127},
        {ip: '58.200.8.212', value: 98},
        {ip: '58.200.8.222', value: 132},
        {ip: '58.200.8.232', value: 92},
        {ip: '58.200.8.242', value: 107},
        {ip: '58.200.8.252', value: 97},
        {ip: '58.200.9.6', value: 124},
        {ip: '58.200.9.16', value: 126},
        {ip: '58.200.9.26', value: 114},
        {ip: '58.200.9.36', value: 121},
        {ip: '58.200.9.46', value: 107},
        {ip: '58.200.9.56', value: 120},
        {ip: '58.200.9.66', value: 129},
        {ip: '58.200.9.76', value: 129},
        {ip: '58.200.9.86', value: 95},
        {ip: '58.200.9.96', value: 130},
        {ip: '58.200.9.106', value: 119},
        {ip: '58.200.9.116', value: 91},
        {ip: '58.200.9.126', value: 100},
        {ip: '58.200.9.136', value: 107},
        {ip: '58.200.9.146', value: 130},
        {ip: '58.200.9.156', value: 94},
        {ip: '58.200.9.166', value: 103},
        {ip: '58.200.9.176', value: 116},
        {ip: '58.200.9.186', value: 130},
        {ip: '58.200.9.196', value: 110},
        {ip: '58.200.9.206', value: 104},
        {ip: '58.200.9.216', value: 129},
        {ip: '58.200.9.226', value: 110},
        {ip: '58.200.9.236', value: 103},
        {ip: '58.200.9.246', value: 116},
        {ip: '58.200.10.0', value: 130},
        {ip: '58.200.10.10', value: 94},
        {ip: '58.200.10.20', value: 119},
        {ip: '58.200.10.30', value: 117},
        {ip: '58.200.10.40', value: 124},
        {ip: '58.200.10.50', value: 91},
        {ip: '58.200.10.60', value: 128},
        {ip: '58.200.10.70', value: 95},
        {ip: '58.200.10.80', value: 96},
        {ip: '58.200.10.90', value: 106},
        {ip: '58.200.10.100', value: 108},
        {ip: '58.200.10.110', value: 112},
        {ip: '58.200.10.120', value: 123},
        {ip: '58.200.10.130', value: 101},
        {ip: '58.200.10.140', value: 135},
        {ip: '58.200.10.150', value: 105},
        {ip: '58.200.10.160', value: 109},
        {ip: '58.200.10.170', value: 117},
        {ip: '58.200.10.180', value: 104},
        {ip: '58.200.10.190', value: 115},
        {ip: '58.200.10.200', value: 95},
        {ip: '58.200.10.210', value: 92},
        {ip: '58.200.10.220', value: 110},
        {ip: '58.200.10.230', value: 104},
        {ip: '58.200.10.240', value: 118},
        {ip: '58.200.10.250', value: 101},
        {ip: '58.200.11.4', value: 91},
        {ip: '58.200.11.14', value: 112},
        {ip: '58.200.11.24', value: 99},
        {ip: '58.200.11.34', value: 99},
        {ip: '58.200.11.44', value: 118},
        {ip: '58.200.11.54', value: 131},
        {ip: '58.200.11.64', value: 93},
        {ip: '58.200.11.74', value: 95},
        {ip: '58.200.11.84', value: 91},
        {ip: '58.200.11.94', value: 92},
        {ip: '58.200.11.104', value: 106},
        {ip: '58.200.11.114', value: 97},
        {ip: '58.200.11.124', value: 95},
        {ip: '58.200.11.134', value: 133},
        {ip: '58.200.11.144', value: 97},
        {ip: '58.200.11.154', value: 109},
        {ip: '58.200.11.164', value: 131},
        {ip: '58.200.11.174', value: 120},
        {ip: '58.200.11.184', value: 108},
        {ip: '58.200.11.194', value: 123},
        {ip: '58.200.11.204', value: 102},
        {ip: '58.200.11.214', value: 90},
        {ip: '58.200.11.224', value: 104},
        {ip: '58.200.11.234', value: 116},
        {ip: '58.200.11.244', value: 120},
        {ip: '58.200.11.254', value: 126},
        {ip: '58.200.12.8', value: 94},
        {ip: '58.200.12.18', value: 129},
        {ip: '58.200.12.28', value: 108},
        {ip: '58.200.12.38', value: 130},
        {ip: '58.200.12.48', value: 91},
        {ip: '58.200.12.58', value: 103},
        {ip: '58.200.12.68', value: 108},
        {ip: '58.200.12.78', value: 132},
        {ip: '58.200.12.88', value: 130},
        {ip: '58.200.12.98', value: 122},
        {ip: '58.200.12.108', value: 109},
        {ip: '58.200.12.118', value: 99},
        {ip: '58.200.12.128', value: 116},
        {ip: '58.200.12.138', value: 101},
        {ip: '58.200.12.148', value: 106},
        {ip: '58.200.12.158', value: 112},
        {ip: '58.200.12.168', value: 117},
        {ip: '58.200.12.178', value: 119},
        {ip: '58.200.12.188', value: 94},
        {ip: '58.200.12.198', value: 132},
        {ip: '58.200.12.208', value: 113},
        {ip: '58.200.12.218', value: 90},
        {ip: '58.200.12.228', value: 112},
        {ip: '58.200.12.238', value: 107},
        {ip: '58.200.12.248', value: 95},
        {ip: '58.200.13.2', value: 131},
        {ip: '58.200.13.12', value: 102},
        {ip: '58.200.13.22', value: 104},
        {ip: '58.200.13.32', value: 105},
        {ip: '58.200.13.42', value: 92},
        {ip: '58.200.13.52', value: 127},
        {ip: '58.200.13.62', value: 101},
        {ip: '58.200.13.72', value: 135},
        {ip: '58.200.13.82', value: 101},
        {ip: '58.200.13.92', value: 133},
        {ip: '58.200.13.102', value: 134},
        {ip: '58.200.13.112', value: 114},
        {ip: '58.200.13.122', value: 117},
        {ip: '58.200.13.132', value: 92},
        {ip: '58.200.13.142', value: 119},
        {ip: '58.200.13.152', value: 118},
        {ip: '58.200.13.162', value: 109},
        {ip: '58.200.13.172', value: 113},
        {ip: '58.200.13.182', value: 118},
        {ip: '58.200.13.192', value: 101},
        {ip: '58.200.13.202', value: 123},
        {ip: '58.200.13.212', value: 123},
        {ip: '58.200.13.222', value: 119},
        {ip: '58.200.13.232', value: 106},
        {ip: '58.200.13.242', value: 114},
        {ip: '58.200.13.252', value: 92},
        {ip: '58.200.14.6', value: 98},
        {ip: '58.200.14.16', value: 96},
        {ip: '58.200.14.26', value: 120},
        {ip: '58.200.14.36', value: 104},
        {ip: '58.200.14.46', value: 129},
        {ip: '58.200.14.56', value: 95},
        {ip: '58.200.14.66', value: 125},
        {ip: '58.200.14.76', value: 116},
        {ip: '58.200.14.86', value: 93},
        {ip: '58.200.14.96', value: 98},
        {ip: '58.200.14.106', value: 131},
        {ip: '58.200.14.116', value: 106},
        {ip: '58.200.14.126', value: 97},
        {ip: '58.200.14.136', value: 102},
        {ip: '58.200.14.146', value: 125},
        {ip: '58.200.14.156', value: 123},
        {ip: '58.200.14.166', value: 114},
        {ip: '58.200.14.176', value: 111},
        {ip: '58.200.14.186', value: 124},
        {ip: '58.200.14.196', value: 123},
        {ip: '58.200.14.206', value: 113},
        {ip: '58.200.14.216', value: 110},
        {ip: '58.200.14.226', value: 128},
        {ip: '58.200.14.236', value: 111},
        {ip: '58.200.14.246', value: 95},
        {ip: '58.200.15.0', value: 101},
        {ip: '58.200.15.10', value: 99},
        {ip: '58.200.15.20', value: 90},
        {ip: '58.200.15.30', value: 96},
        {ip: '58.200.15.40', value: 135},
        {ip: '58.200.15.50', value: 113},
        {ip: '58.200.15.60', value: 106},
        {ip: '58.200.15.70', value: 135},
        {ip: '58.200.15.80', value: 129},
        {ip: '58.200.15.90', value: 106},
        {ip: '58.200.15.100', value: 95},
        {ip: '58.200.15.110', value: 132},
        {ip: '58.200.15.120', value: 112},
        {ip: '58.200.15.130', value: 113},
        {ip: '58.200.15.140', value: 119},
        {ip: '58.200.15.150', value: 124},
        {ip: '58.200.15.160', value: 93},
        {ip: '58.200.15.170', value: 91},
        {ip: '58.200.15.180', value: 120},
        {ip: '58.200.15.190', value: 96},
        {ip: '58.200.15.200', value: 108},
        {ip: '58.200.15.210', value: 91},
        {ip: '58.200.15.220', value: 123},
        {ip: '58.200.15.230', value: 104},
        {ip: '58.200.15.240', value: 106},
        {ip: '58.200.15.250', value: 122},
        {ip: '58.200.16.4', value: 99},
        {ip: '58.200.16.14', value: 109},
        {ip: '58.200.16.24', value: 131},
        {ip: '58.200.16.34', value: 107},
        {ip: '58.200.16.44', value: 125},
        {ip: '58.200.16.54', value: 128},
        {ip: '58.200.16.64', value: 122},
        {ip: '58.200.16.74', value: 115},
        {ip: '58.200.16.84', value: 124},
        {ip: '58.200.16.94', value: 134},
        {ip: '58.200.16.104', value: 110},
        {ip: '58.200.16.114', value: 102},
        {ip: '58.200.16.124', value: 99},
        {ip: '58.200.16.134', value: 113},
        {ip: '58.200.16.144', value: 100},
        {ip: '58.200.16.154', value: 132},
        {ip: '58.200.16.164', value: 102},
        {ip: '58.200.16.174', value: 104},
        {ip: '58.200.16.184', value: 119},
        {ip: '58.200.16.194', value: 122},
        {ip: '58.200.16.204', value: 119},
        {ip: '58.200.16.214', value: 135},
        {ip: '58.200.16.224', value: 126},
        {ip: '58.200.16.234', value: 105},
        {ip: '58.200.16.244', value: 126},
        {ip: '58.200.16.254', value: 130},
        {ip: '58.200.17.8', value: 101},
        {ip: '58.200.17.18', value: 106},
        {ip: '58.200.17.28', value: 109},
        {ip: '58.200.17.38', value: 124},
        {ip: '58.200.17.48', value: 90},
        {ip: '58.200.17.58', value: 101},
        {ip: '58.200.17.68', value: 109},
        {ip: '58.200.17.78', value: 111},
        {ip: '58.200.17.88', value: 117},
        {ip: '58.200.17.98', value: 128},
        {ip: '58.200.17.108', value: 122},
        {ip: '58.200.17.118', value: 117},
        {ip: '58.200.17.128', value: 122},
        {ip: '58.200.17.138', value: 90},
        {ip: '58.200.17.148', value: 106},
        {ip: '58.200.17.158', value: 111},
        {ip: '58.200.17.168', value: 130},
        {ip: '58.200.17.178', value: 114},
        {ip: '58.200.17.188', value: 132},
        {ip: '58.200.17.198', value: 90},
        {ip: '58.200.17.208', value: 115},
        {ip: '58.200.17.218', value: 114},
        {ip: '58.200.17.228', value: 130},
        {ip: '58.200.17.238', value: 130},
        {ip: '58.200.17.248', value: 128},
        {ip: '58.200.18.2', value: 122},
        {ip: '58.200.18.12', value: 130},
        {ip: '58.200.18.22', value: 101},
        {ip: '58.200.18.32', value: 118},
        {ip: '58.200.18.42', value: 130},
        {ip: '58.200.18.52', value: 128},
        {ip: '58.200.18.62', value: 91},
        {ip: '58.200.18.72', value: 123},
        {ip: '58.200.18.82', value: 128},
        {ip: '58.200.18.92', value: 94},
        {ip: '58.200.18.102', value: 100},
        {ip: '58.200.18.112', value: 118},
        {ip: '58.200.18.122', value: 123},
        {ip: '58.200.18.132', value: 129},
        {ip: '58.200.18.142', value: 113},
        {ip: '58.200.18.152', value: 133},
        {ip: '58.200.18.162', value: 126},
        {ip: '58.200.18.172', value: 132},
        {ip: '58.200.18.182', value: 121},
        {ip: '58.200.18.192', value: 118},
        {ip: '58.200.18.202', value: 107},
        {ip: '58.200.18.212', value: 112},
        {ip: '58.200.18.222', value: 102},
        {ip: '58.200.18.232', value: 113},
        {ip: '58.200.18.242', value: 93},
        {ip: '58.200.18.252', value: 106},
        {ip: '58.200.19.6', value: 97},
        {ip: '58.200.19.16', value: 105},
        {ip: '58.200.19.26', value: 122},
        {ip: '58.200.19.36', value: 108},
        {ip: '58.200.19.46', value: 107},
        {ip: '58.200.19.56', value: 96},
        {ip: '58.200.19.66', value: 104},
        {ip: '58.200.19.76', value: 99},
        {ip: '58.200.19.86', value: 123},
        {ip: '58.200.19.96', value: 131},
        {ip: '58.200.19.106', value: 107},
        {ip: '58.200.19.116', value: 110},
        {ip: '58.200.19.126', value: 116},
        {ip: '58.200.19.136', value: 128},
        {ip: '58.200.19.146', value: 115},
        {ip: '58.200.19.156', value: 108},
        {ip: '58.200.19.166', value: 118},
        {ip: '58.200.19.176', value: 105},
        {ip: '58.200.19.186', value: 93},
        {ip: '58.200.19.196', value: 91},
        {ip: '58.200.19.206', value: 130},
        {ip: '58.200.19.216', value: 97},
        {ip: '58.200.19.226', value: 113},
        {ip: '58.200.19.236', value: 133},
        {ip: '58.200.19.246', value: 134},
        {ip: '58.200.20.0', value: 121},
        {ip: '58.200.20.10', value: 119},
        {ip: '58.200.20.20', value: 125},
        {ip: '58.200.20.30', value: 123},
        {ip: '58.200.20.40', value: 116},
        {ip: '58.200.20.50', value: 95},
        {ip: '58.200.20.60', value: 121},
        {ip: '58.200.20.70', value: 119},
        {ip: '58.200.20.80', value: 124},
        {ip: '58.200.20.90', value: 106},
        {ip: '58.200.20.100', value: 100},
        {ip: '58.200.20.110', value: 101},
        {ip: '58.200.20.120', value: 109},
        {ip: '58.200.20.130', value: 119},
        {ip: '58.200.20.140', value: 127},
        {ip: '58.200.20.150', value: 113},
        {ip: '58.200.20.160', value: 118},
        {ip: '58.200.20.170', value: 128},
        {ip: '58.200.20.180', value: 119},
        {ip: '58.200.20.190', value: 94},
        {ip: '58.200.20.200', value: 120},
        {ip: '58.200.20.210', value: 135},
        {ip: '58.200.20.220', value: 98},
        {ip: '58.200.20.230', value: 132},
        {ip: '58.200.20.240', value: 128},
        {ip: '58.200.20.250', value: 94},
        {ip: '58.200.21.4', value: 113},
        {ip: '58.200.21.14', value: 109},
        {ip: '58.200.21.24', value: 110},
        {ip: '58.200.21.34', value: 126},
        {ip: '58.200.21.44', value: 96},
        {ip: '58.200.21.54', value: 97},
        {ip: '58.200.21.64', value: 120},
        {ip: '58.200.21.74', value: 128},
        {ip: '58.200.21.84', value: 117},
        {ip: '58.200.21.94', value: 106},
        {ip: '58.200.21.104', value: 123},
        {ip: '58.200.21.114', value: 128},
        {ip: '58.200.21.124', value: 98},
        {ip: '58.200.21.134', value: 93},
        {ip: '58.200.21.144', value: 114},
        {ip: '58.200.21.154', value: 102},
        {ip: '58.200.21.164', value: 125},
        {ip: '58.200.21.174', value: 129},
        {ip: '58.200.21.184', value: 129},
        {ip: '58.200.21.194', value: 106},
        {ip: '58.200.21.204', value: 103},
        {ip: '58.200.21.214', value: 91},
        {ip: '58.200.21.224', value: 106},
        {ip: '58.200.21.234', value: 114},
        {ip: '58.200.21.244', value: 128},
        {ip: '58.200.21.254', value: 117},
        {ip: '58.200.22.8', value: 91},
        {ip: '58.200.22.18', value: 124},
        {ip: '58.200.22.28', value: 113},
        {ip: '58.200.22.38', value: 105},
        {ip: '58.200.22.48', value: 111},
        {ip: '58.200.22.58', value: 129},
        {ip: '58.200.22.68', value: 131},
        {ip: '58.200.22.78', value: 128},
        {ip: '58.200.22.88', value: 115},
        {ip: '58.200.22.98', value: 111},
        {ip: '58.200.22.108', value: 127},
        {ip: '58.200.22.118', value: 106},
        {ip: '58.200.22.128', value: 131},
        {ip: '58.200.22.138', value: 90},
        {ip: '58.200.22.148', value: 111},
        {ip: '58.200.22.158', value: 130},
        {ip: '58.200.22.168', value: 113},
        {ip: '58.200.22.178', value: 103},
        {ip: '58.200.22.188', value: 117},
        {ip: '58.200.22.198', value: 91},
        {ip: '58.200.22.208', value: 94},
        {ip: '58.200.22.218', value: 115},
        {ip: '58.200.22.228', value: 122},
        {ip: '58.200.22.238', value: 126},
        {ip: '58.200.22.248', value: 110},
        {ip: '58.200.23.2', value: 91},
        {ip: '58.200.23.12', value: 123},
        {ip: '58.200.23.22', value: 124},
        {ip: '58.200.23.32', value: 105},
        {ip: '58.200.23.42', value: 96},
        {ip: '58.200.23.52', value: 94},
        {ip: '58.200.23.62', value: 109},
        {ip: '58.200.23.72', value: 135},
        {ip: '58.200.23.82', value: 116},
        {ip: '58.200.23.92', value: 94},
        {ip: '58.200.23.102', value: 110},
        {ip: '58.200.23.112', value: 103},
        {ip: '58.200.23.122', value: 115},
        {ip: '58.200.23.132', value: 100},
        {ip: '58.200.23.142', value: 92},
        {ip: '58.200.23.152', value: 112},
        {ip: '58.200.23.162', value: 125},
        {ip: '58.200.23.172', value: 115},
        {ip: '58.200.23.182', value: 126},
        {ip: '58.200.23.192', value: 119},
        {ip: '58.200.23.202', value: 116},
        {ip: '58.200.23.212', value: 99},
        {ip: '58.200.23.222', value: 94},
        {ip: '58.200.23.232', value: 102},
        {ip: '58.200.23.242', value: 111},
        {ip: '58.200.23.252', value: 110},
        {ip: '58.200.24.6', value: 112},
        {ip: '58.200.24.16', value: 128},
        {ip: '58.200.24.26', value: 121},
        {ip: '58.200.24.36', value: 104},
        {ip: '58.200.24.46', value: 116},
        {ip: '58.200.24.56', value: 134},
        {ip: '58.200.24.66', value: 126},
        {ip: '58.200.24.76', value: 110},
        {ip: '58.200.24.86', value: 135},
        {ip: '58.200.24.96', value: 132},
        {ip: '58.200.24.106', value: 100},
        {ip: '58.200.24.116', value: 125},
        {ip: '58.200.24.126', value: 111},
        {ip: '58.200.24.136', value: 128},
        {ip: '58.200.24.146', value: 116},
        {ip: '58.200.24.156', value: 124},
        {ip: '58.200.24.166', value: 123},
        {ip: '58.200.24.176', value: 118},
        {ip: '58.200.24.186', value: 111},
        {ip: '58.200.24.196', value: 115},
        {ip: '58.200.24.206', value: 96},
        {ip: '58.200.24.216', value: 113},
        {ip: '58.200.24.226', value: 99},
        {ip: '58.200.24.236', value: 90},
        {ip: '58.200.24.246', value: 90},
        {ip: '58.200.25.0', value: 114},
        {ip: '58.200.25.10', value: 132},
        {ip: '58.200.25.20', value: 126},
        {ip: '58.200.25.30', value: 105},
        {ip: '58.200.25.40', value: 95},
        {ip: '58.200.25.50', value: 119},
        {ip: '58.200.25.60', value: 127},
        {ip: '58.200.25.70', value: 106},
        {ip: '58.200.25.80', value: 120},
        {ip: '58.200.25.90', value: 116},
        {ip: '58.200.25.100', value: 106},
        {ip: '58.200.25.110', value: 114},
        {ip: '58.200.25.120', value: 90},
        {ip: '58.200.25.130', value: 101},
        {ip: '58.200.25.140', value: 113},
        {ip: '58.200.25.150', value: 102},
        {ip: '58.200.25.160', value: 102},
        {ip: '58.200.25.170', value: 131},
        {ip: '58.200.25.180', value: 97},
        {ip: '58.200.25.190', value: 119},
        {ip: '58.200.25.200', value: 105},
        {ip: '58.200.25.210', value: 117},
        {ip: '58.200.25.220', value: 104},
        {ip: '58.200.25.230', value: 103},
        {ip: '58.200.25.240', value: 123},
        {ip: '58.200.25.250', value: 100},
        {ip: '58.200.26.4', value: 125},
        {ip: '58.200.26.14', value: 99},
        {ip: '58.200.26.24', value: 107},
        {ip: '58.200.26.34', value: 114},
        {ip: '58.200.26.44', value: 115},
        {ip: '58.200.26.54', value: 91},
        {ip: '58.200.26.64', value: 108},
        {ip: '58.200.26.74', value: 98},
        {ip: '58.200.26.84', value: 99},
        {ip: '58.200.26.94', value: 135},
        {ip: '58.200.26.104', value: 101},
        {ip: '58.200.26.114', value: 135},
        {ip: '58.200.26.124', value: 102},
        {ip: '58.200.26.134', value: 109},
        {ip: '58.200.26.144', value: 133},
        {ip: '58.200.26.154', value: 132},
        {ip: '58.200.26.164', value: 135},
        {ip: '58.200.26.174', value: 132},
        {ip: '58.200.26.184', value: 106},
        {ip: '58.200.26.194', value: 120},
        {ip: '58.200.26.204', value: 90},
        {ip: '58.200.26.214', value: 116},
        {ip: '58.200.26.224', value: 94},
        {ip: '58.200.26.234', value: 128},
        {ip: '58.200.26.244', value: 121},
        {ip: '58.200.26.254', value: 112},
        {ip: '58.200.27.8', value: 92},
        {ip: '58.200.27.18', value: 94},
        {ip: '58.200.27.28', value: 118},
        {ip: '58.200.27.38', value: 129},
        {ip: '58.200.27.48', value: 129},
        {ip: '58.200.27.58', value: 100},
        {ip: '58.200.27.68', value: 127},
        {ip: '58.200.27.78', value: 125},
        {ip: '58.200.27.88', value: 130},
        {ip: '58.200.27.98', value: 94},
        {ip: '58.200.27.108', value: 119},
        {ip: '58.200.27.118', value: 134},
        {ip: '58.200.27.128', value: 102},
        {ip: '58.200.27.138', value: 102},
        {ip: '58.200.27.148', value: 116},
        {ip: '58.200.27.158', value: 104},
        {ip: '58.200.27.168', value: 113},
        {ip: '58.200.27.178', value: 109},
        {ip: '58.200.27.188', value: 92},
        {ip: '58.200.27.198', value: 106},
        {ip: '58.200.27.208', value: 115},
        {ip: '58.200.27.218', value: 127},
        {ip: '58.200.27.228', value: 133},
        {ip: '58.200.27.238', value: 104},
        {ip: '58.200.27.248', value: 120},
        {ip: '58.200.28.2', value: 104},
        {ip: '58.200.28.12', value: 91},
        {ip: '58.200.28.22', value: 92},
        {ip: '58.200.28.32', value: 91},
        {ip: '58.200.28.42', value: 104},
        {ip: '58.200.28.52', value: 93},
        {ip: '58.200.28.62', value: 104},
        {ip: '58.200.28.72', value: 94},
        {ip: '58.200.28.82', value: 134},
        {ip: '58.200.28.92', value: 132},
        {ip: '58.200.28.102', value: 132},
        {ip: '58.200.28.112', value: 103},
        {ip: '58.200.28.122', value: 114},
        {ip: '58.200.28.132', value: 131},
        {ip: '58.200.28.142', value: 97},
        {ip: '58.200.28.152', value: 112},
        {ip: '58.200.28.162', value: 103},
        {ip: '58.200.28.172', value: 90},
        {ip: '58.200.28.182', value: 128},
        {ip: '58.200.28.192', value: 118},
        {ip: '58.200.28.202', value: 101},
        {ip: '58.200.28.212', value: 117},
        {ip: '58.200.28.222', value: 117},
        {ip: '58.200.28.232', value: 102},
        {ip: '58.200.28.242', value: 121},
        {ip: '58.200.28.252', value: 113},
        {ip: '58.200.29.6', value: 99},
        {ip: '58.200.29.16', value: 96},
        {ip: '58.200.29.26', value: 124},
        {ip: '58.200.29.36', value: 94},
        {ip: '58.200.29.46', value: 104},
        {ip: '58.200.29.56', value: 104},
        {ip: '58.200.29.66', value: 99},
        {ip: '58.200.29.76', value: 109},
        {ip: '58.200.29.86', value: 93},
        {ip: '58.200.29.96', value: 127},
        {ip: '58.200.29.106', value: 125},
        {ip: '58.200.29.116', value: 133},
        {ip: '58.200.29.126', value: 98},
        {ip: '58.200.29.136', value: 91},
        {ip: '58.200.29.146', value: 128},
        {ip: '58.200.29.156', value: 106},
        {ip: '58.200.29.166', value: 108},
        {ip: '58.200.29.176', value: 135},
        {ip: '58.200.29.186', value: 124},
        {ip: '58.200.29.196', value: 101},
        {ip: '58.200.29.206', value: 107},
        {ip: '58.200.29.216', value: 109},
        {ip: '58.200.29.226', value: 109},
        {ip: '58.200.29.236', value: 111},
        {ip: '58.200.29.246', value: 114},
        {ip: '58.200.30.0', value: 132},
        {ip: '58.200.30.10', value: 130},
        {ip: '58.200.30.20', value: 102},
        {ip: '58.200.30.30', value: 109},
        {ip: '58.200.30.40', value: 105},
        {ip: '58.200.30.50', value: 118},
        {ip: '58.200.30.60', value: 127},
        {ip: '58.200.30.70', value: 130},
        {ip: '58.200.30.80', value: 127},
        {ip: '58.200.30.90', value: 114},
        {ip: '58.200.30.100', value: 96},
        {ip: '58.200.30.110', value: 105},
        {ip: '58.200.30.120', value: 109},
        {ip: '58.200.30.130', value: 131},
        {ip: '58.200.30.140', value: 107},
        {ip: '58.200.30.150', value: 99},
        {ip: '58.200.30.160', value: 95},
        {ip: '58.200.30.170', value: 113},
        {ip: '58.200.30.180', value: 116},
        {ip: '58.200.30.190', value: 116},
        {ip: '58.200.30.200', value: 91},
        {ip: '58.200.30.210', value: 112},
        {ip: '58.200.30.220', value: 130},
        {ip: '58.200.30.230', value: 100},
        {ip: '58.200.30.240', value: 97},
        {ip: '58.200.30.250', value: 106},
        {ip: '58.200.31.4', value: 125},
        {ip: '58.200.31.14', value: 94},
        {ip: '58.200.31.24', value: 132},
        {ip: '58.200.31.34', value: 120},
        {ip: '58.200.31.44', value: 118},
        {ip: '58.200.31.54', value: 100},
        {ip: '58.200.31.64', value: 111},
        {ip: '58.200.31.74', value: 108},
        {ip: '58.200.31.84', value: 123},
        {ip: '58.200.31.94', value: 100},
        {ip: '58.200.31.104', value: 108},
        {ip: '58.200.31.114', value: 131},
        {ip: '58.200.31.124', value: 133},
        {ip: '58.200.31.134', value: 93},
        {ip: '58.200.31.144', value: 132},
        {ip: '58.200.31.154', value: 131},
        {ip: '58.200.31.164', value: 116},
        {ip: '58.200.31.174', value: 128},
        {ip: '58.200.31.184', value: 108},
        {ip: '58.200.31.194', value: 126},
        {ip: '58.200.31.204', value: 113},
        {ip: '58.200.31.214', value: 126},
        {ip: '58.200.31.224', value: 103},
        {ip: '58.200.31.234', value: 113},
        {ip: '58.200.31.244', value: 90},
        {ip: '58.200.31.254', value: 131}
    ];
    var result = [];
    var ip_api_url = 'http://api.map.baidu.com/location/ip?ak=9eef5b2d2aee567c9583634cd98a89aa&coor=bd09ll';
    async.each(point, function (po,cb) {
        var tpUrl = ip_api_url + '&ip=' + po.ip;
        request.get(tpUrl, function (err, response, body) {
            if (err) return cb(error.ServerInternalError);
            body=JSON.parse(body);
            console.log(body.address);
            if(body.status==0) {
                result.push({lng: body.content.point.x, lat: body.content.point.y, count: po.value});
            }else{
                console.log(body);
            }
            cb();
        });
    }, function (err) {
        res.json(result);
    });
}